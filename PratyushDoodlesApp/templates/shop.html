<!-- about.html -->
{% extends 'ui/base_page.html' %}

{% block content %}


<div class="container text-center">
    <div class="shell">
        <div class="container">
            <div class="row">
                {% if data.products %}
                    {% for product in data.products %}
                        <div class="col-md-3">
                            {% with product=product %}
                                {% include 'ui/product_card.html' %}
                            {% endwith %}
                        </div>
                    {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
    function addItemToCart(button) {
        // Use the socket variable to interact with the WebSocket connection
        let product_id = $(button).attr('product_id')
        socket.emit('addItemToCart', { product_id: product_id });
        console.log("Event: addItemToCart", product_id)
    }

    function updateCart() {
        return new Promise((resolve, reject) => {
        fetch('/getCartItems')
            .then(response => response.text()) // Get the rendered template as HTML
            .then(data => {

                const cartContainer = document.getElementById('cart-container');
                cartContainer.innerHTML = data; // Insert the template HTML into the container
               
                const cartButton = document.getElementById('nav-cart-button');
                cartButton.click()
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });
    }

    socket.on('updateCart', updateCart);
</script>
{% endblock %}