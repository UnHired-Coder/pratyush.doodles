<!-- about.html -->
{% extends 'ui/base_page.html' %}

{% block content %}

<div class="container text-center m-5">
    <div class="row justify-content-center mx-auto">
        <div id="carouselExampleDark" class="carousel carousel-dark slide" data-interval="300" data-bs-ride="carousel" style="height: 20%; width: 45%;  border-radius: 10px;">
            <div class="carousel-indicators" style="opacity: 0.2; width: 50px; bottom: 0; left: 0;">
              <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
              <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="1" aria-label="Slide 2"></button>
              <!-- <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="2" aria-label="Slide 3"></button> -->
            </div>
            <div class="carousel-inner" style="border-radius: 10px;">
              <div class="carousel-item active" data-bs-interval="3000" style="border-radius: 10px;">
                <img src="{{ url_for('static', filename='images/promos/promo_1.png') }}" class="d-block w-100" alt="..." style=" border-radius: 10px;">
                <!-- <div class="carousel-caption d-none d-md-block"> -->
                  <!-- <h5>First slide label</h5>
                  <p>Some representative placeholder content for the first slide.</p> -->
                <!-- </div> -->
              </div>
              <div class="carousel-item" data-bs-interval="3000" style="border-radius: 10px;">
                <img src="{{ url_for('static', filename='images/promos/promo_2.png') }}" class="d-block w-100" alt="...">
                <!-- <div class="carousel-caption d-none d-md-block"> -->
                  <!-- <h5>Second slide label</h5>
                  <p>Some representative placeholder content for the second slide.</p> -->
                <!-- </div> -->
              </div>
              <!-- <div class="carousel-item" data-bs-interval="3000" style="border-radius: 10px;">
                <img src="{{ url_for('static', filename='images/promos/promo_3.png') }}"class="d-block w-100" alt="..."> -->
                <!-- <div class="carousel-caption d-none d-md-block"> -->
                  <!-- <h5>Third slide label</h5> -->
                  <!-- <p>Some representative placeholder content for the third slide.</p> -->
                <!-- </div> -->
              <!-- </div> -->
            </div>
            <!-- <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleDark" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleDark" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Next</span>
            </button> -->
          </div>

        {% if data.products_with_categories %}
            {% for category, products in data.products_with_categories.items() %}
                <div id="products-list" class="row justify-content-center mx-auto">
                    {% if products and products|length > 0 %}
                        <h4 class="mb-3 mt-3 p-2 sticky-top" style="background-color: white; top: 55px;  box-shadow: 0 2px 0px -1px rgba(0, 0, 0, 0.1);" id="{{ category }}">{{ category }}</h4>
                    {% endif %}
                </div>    
                <div class="col-auto">
                    <button id="viewAllButton" class="dark-button align-items-center"> Show more </button>
                </div>
            {% endfor %}
        {% else %}
            <p>No products listed!</p>
        {% endif %}
    </div>
</div>

<script>
    // Pagination
    let page = 1;
    let category = 'Stickers'
    const productsListDiv = document.getElementById('products-list');

    function getData(page) {
        fetch('/get_products/?page='+page+'&category='+category)
            .then(response => response.text()) // Get the rendered template as HTML
            .then(data => {
                const itemElement = document.createElement('div');
                itemElement.innerHTML = data
                if(data != ""){
                    viewAllButton.style.display = 'block';
                }
                productsListDiv.appendChild(itemElement);
                setUpAnimation();
            })
            .catch(error => {
                showError(error)
            });
    }

    function handleScroll() {
        // @var int totalPageHeight
        var totalPageHeight = document.body.offsetHeight;

        // @var int scrollPoint
        var scrollPoint = window.scrollY + window.innerHeight;

        // check if we hit the bottom of the page
        if (scrollPoint >= totalPageHeight) {
            appendDataToContent();
        }
    }

    // if ((window.innerHeight + window.scrollY) >= document.body.scrollHeight) {


   // Event listeners for scrolling
   window.addEventListener('scroll', handleScroll);
   window.addEventListener('touchmove', handleScroll);     

   async function appendDataToContent() {
        await getData(page);
        page++;
    }

    appendDataToContent();

    function setUpAnimation() {
        const hoverCards = document.querySelectorAll(".wsk-cp-product"); // Replace "hover-card" with the actual ID or class of your card
        hoverCards.forEach(function (hoverCard) {
            const productImages = hoverCard.querySelectorAll(".wsk-cp-img");

            let currentIndex = 0;
            let intervalId = null; // Initialize a variable to store the interval ID

            // initiallly make last visible
            for (let i = 1; i < productImages.length; i++) { 
                productImages[i].style.opacity = 0;
            }
            productImages[currentIndex].style.opacity = 1;


            if (productImages.length > 0) {
                hoverCard.addEventListener("mouseenter", function () {
                    //start
                    console.log('start', intervalId, currentIndex);
                    if (intervalId === null) {
                        intervalId = setInterval(function () {
                            console.log('start', intervalId, currentIndex);

                            productImages[currentIndex].style.opacity = 0; // Hide the current image
                            currentIndex = (currentIndex + 1) % productImages.length; // Cycle through the images
                            productImages[currentIndex].style.opacity = 1; // Show the next image
                        }, 1000);

                        console.log('start', intervalId, currentIndex);

                    }
                });
                hoverCard.addEventListener("mouseleave", function () {
                    //stop

                    if (intervalId !== null) {
                        // reset
                        console.log('stop', intervalId, currentIndex);
                        clearInterval(intervalId);


                        productImages[currentIndex].style.opacity = 0;
                        productImages[0].style.opacity = 1;

                        intervalId = null;
                        currentIndex = 0;
                    }
                });
            }
        });
    }

    var viewAllButton = document.getElementById('viewAllButton');
    viewAllButton.addEventListener('click', function () {
            appendDataToContent();
            viewAllButton.style.display = 'none';
        });

</script>
{% endblock %}