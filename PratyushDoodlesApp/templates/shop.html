<!-- about.html -->
{% extends 'ui/base_page.html' %}

{% block content %}

<div class="container text-center pt-5 pb-5">
    <div class="row justify-content-center mx-auto">
            <!-- height: 20%; -->
            <!-- <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9 mb-5">
                <div id="carouselExampleDark" class="carousel carousel-dark slide" data-interval="300" data-bs-ride="carousel" style="border-radius: 10px;">
                    <div class="carousel-indicators" style="opacity: 0.2; bottom: 0; left: 0;">
                    <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1" style="width: 10px;"></button>
                    <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="1" aria-label="Slide 2" style="width: 10px;"></button>
                    </div>
                    <div class="carousel-inner" style="border-radius: 10px;">
                    <div class="carousel-item active" data-bs-interval="3000" style="border-radius: 10px;">
                        <img src="{{ url_for('static', filename='images/promos/promo_1.png') }}" class="d-block w-100" alt="..." style=" border-radius: 10px;">
                    </div>
                    <div class="carousel-item" data-bs-interval="3000" style="border-radius: 10px;">
                        <img src="{{ url_for('static', filename='images/promos/promo_2.png') }}" class="d-block w-100" alt="...">
                    </div>
                    </div>
                </div>
            </div> -->

        <div id="applied-filters" class="container justify-content-center" style="float: left;">
            
        </div>

        {% if data.products_with_categories %}
            {% for category, products in data.products_with_categories.items() %}

                <!-- Category promo -->
                {% if category == "Cupid's Crew" %}
                <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9 mb-5">
                    <div class="carouselExampleDark" class="carousel carousel-dark slide" data-interval="300" data-bs-ride="carousel"
                        style="border-radius: 10px;">
                        <div class="carousel-indicators" style="opacity: 0.2; bottom: 0; left: 0;">
                            <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="0" class="active"
                                aria-current="true" aria-label="Slide 1" style="width: 10px;"></button>
                        </div>
                        <div class="carousel-inner" style="border-radius: 10px;">
                            <div class="carousel-item active" data-bs-interval="3000" style="border-radius: 10px;">
                                <img src="{{ url_for('static', filename='images/promos/promo_3.png') }}?update=3" class="d-block w-100" alt="..."
                                    style=" border-radius: 10px;">
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if category == "Cat (Lity Fam)" %}
                <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9 mb-5">
                    <div class="carouselExampleDark" class="carousel carousel-dark slide" data-interval="300" data-bs-ride="carousel"
                        style="border-radius: 10px;">
                        <div class="carousel-indicators" style="opacity: 0.2; bottom: 0; left: 0;">
                            <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="0" class="active"
                                aria-current="true" aria-label="Slide 1" style="width: 10px;"></button>
                        </div>
                        <div class="carousel-inner" style="border-radius: 10px;">
                            <div class="carousel-item active" data-bs-interval="3000" style="border-radius: 10px;">
                                <img src="{{ url_for('static', filename='images/promos/promo_4.png') }}?update=3" class="d-block w-100" alt="..."
                                    style=" border-radius: 10px;">
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if category == "Stickers" %}
                <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9 mb-5">
                    <div class="carouselExampleDark" class="carousel carousel-dark slide" data-interval="300" data-bs-ride="carousel"
                        style="border-radius: 10px;">
                        <div class="carousel-indicators" style="opacity: 0.2; bottom: 0; left: 0;">
                            <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="0" class="active"
                                aria-current="true" aria-label="Slide 1" style="width: 10px;"></button>
                            <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="1" aria-label="Slide 2"
                                style="width: 10px;"></button>
                        </div>
                        <div class="carousel-inner" style="border-radius: 10px;">
                            <div class="carousel-item active" data-bs-interval="5000" style="border-radius: 10px;">
                                <img src="{{ url_for('static', filename='images/promos/promo_1.png') }}?update=3" class="d-block w-100" alt="..."
                                    style=" border-radius: 10px;">
                            </div>
                            <div class="carousel-item" data-bs-interval="5000" style="border-radius: 10px;">
                                <img src="{{ url_for('static', filename='images/promos/promo_2.png') }}?update=3" class="d-block w-100"
                                    alt="...">
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}


                <div id="category-products-{{ category }}">
                    <div id="scroll-head-{{ category }}"></div>
                    <div id="products-list-{{ category }}" class="row justify-content-center mx-auto">
                        {% if products and products|length > 0 %}
                            <h4 class="mb-3 mt-3 p-2 sticky-top style-category" style="z-index: 888; top: 60px;  box-shadow: 0 2px 0px -1px rgba(0, 0, 0, 0.1); max-width: 250px;" id="{{ category }}">{{ category }}</h4>
                        {% endif %}
                    </div>    
                    <div category="{{ category }}" page="2" class="showMoreButton col-auto pb-5">
                        <p class="show-more-button align-items-center"> Show more <img class="ic-20" src="{{ url_for('static', filename='images/ic_down.png') }}" alt="">  </p>
                        <span class="loader align-items-center" style="display: none; margin: auto;"></span>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p>No products listed!</p>
        {% endif %}
    </div>
</div>


<div class="container text-center pt-2 pb-5">
    <div class="row pt-3">
        <div class="d-flex">
            <div class="container-sm">
                <h2>
                    Comics!
                </h2>
                <div class="col-sm">
                    <p class="pt-4">If you're in the mood for a good laugh or a touch of boredom (hey, sometimes that's
                        fun too!), you're in the right place. <br> <b>StickyShape's crafts</b> is your dose
                        of humor, witty insights, and a dash of randomness through our comics.</p>

                    <p>Keep doodling, keep smiling!</p>

                </div>
            </div>
        </div>
    </div>
    <div class="row mb-5">
        <div class="col-sm">
            <img class="img-fluid" style="width: 600px;"
                 src="{{ url_for('static', filename='images/about_commics.png') }}" alt="">
        </div>
        <p class="mt-5">
            Follow us on <a class="mb-5 mt-5" href="https://www.instagram.com/stickyshape/" target="_blank"><img
                style="width: 200px;" src="{{ url_for('static', filename='images/ic_instagram.png') }}"
                alt=""></a> to stay updated :)
        </p>
    </div>
</div>


<script>
    // Pagination
    var categoryStickers = 'Stickers'
    var categoryMovieCards= 'Movie Cards'
    var categoryCatStickersLityFam= 'Cat (Lity Fam)'
    var categoryCupidsCrew= 'Cupid\'s Crew'


    function updateFilters(appliedFilters){
        let filtersUi = document.getElementById("applied-filters")
        let html = ""

        filtersUi.innerHTML = html

        if(appliedFilters == null){
            let url = new URL(window.location.href);
            url.searchParams.delete('filter_by');
            window.location.replace(url)
            return
        }

        console.log("appliedFilters")
        if(appliedFilters!=null && appliedFilters != "" ){
            for(i in appliedFilters){
                if(i == 0){
                    html +=  "<div style = 'float: left; margin-right: 10px;'> Filterd by: </div>"
                }
                html +=  "<div class= 'filters-applied' style = 'float: left; margin-right: 10px;'>" + appliedFilters[i] +"</div>"
            }
            html += "<img class='ic-30' id='clear-filters' onClick = 'updateFilters(null)' style = 'float: left; margin-right: 10px;' src='{{ url_for('static', filename='images/ic_close.svg') }}'>"
        }
        filtersUi.innerHTML = html
    }


    var filters = []
    function getData(page, category, button) {
        let productsListDiv = document.getElementById('products-list-'+category);
        //console.log(productsListDiv);
        

        let url = '/get_products/?page='+page+'&category='+category
        let test = new URL(window.location.href)    
        let a = test.searchParams.getAll('filter_by')


        for(i in a){
            url+='&filter_by='+a[i]
        }

        console.log(url)

        fetch(url)
            .then(response => response.text()) // Get the rendered template as HTML
            .then(data => {

                _data = JSON.parse(data)

                products = _data["products"]
                appliedFilters = _data["filters"]
                hasMoreItems = _data["has_more_items"]
                hasItems = _data["has_items"]


                if(!hasItems){
                    document.getElementById("category-products-"+category).style.display = 'none'
                }

                // Update products
                const itemElement = document.createElement('div');
                itemElement.innerHTML = products;

                //update filters
                updateFilters(appliedFilters);
                
                if(button != null){
                    button.children[1].style.display = 'none';

                    //update more button
                    if(hasMoreItems){
                        button.children[0].style.display = 'block'
                    } else {
                        button.children[0].style.display = 'none'
                    }
                }
                
                productsListDiv.appendChild(itemElement);
                setUpAnimation();
            })
            .catch(error => {
                showError(error)
            });
    }

    function handleScroll() {
        // @var int totalPageHeight
        let totalPageHeight = document.body.offsetHeight;

        // @var int scrollPoint
        let scrollPoint = window.scrollY + window.innerHeight;

        // check if we hit the bottom of the page
        if (scrollPoint >= totalPageHeight) {
            //TODO:: appendDataToContent();
        }
    }

    // if ((window.innerHeight + window.scrollY) >= document.body.scrollHeight) {


   // Event listeners for scrolling
   window.addEventListener('scroll', handleScroll);
   window.addEventListener('touchmove', handleScroll);     

   async function appendDataToContent(page, category, button) {
        await getData(page, category, button);
   }

   appendDataToContent(1, categoryCupidsCrew, null);
   appendDataToContent(1, categoryCatStickersLityFam, null);
   appendDataToContent(1, categoryStickers, null);
   //appendDataToContent(1, categoryMovieCards, null);

    function setUpAnimation() {
        const hoverCards = document.querySelectorAll(".hover-auto-transition-product"); // Replace "hover-card" with the actual ID or class of your card
        hoverCards.forEach(function (hoverCard) {
            const productImages = hoverCard.querySelectorAll(".wsk-cp-img");

            let currentIndex = 0;
            let intervalId = null; // Initialize a variable to store the interval ID

            // initiallly make last visible
            for (let i = 1; i < productImages.length; i++) { 
                productImages[i].style.opacity = 0;
            }
            productImages[currentIndex].style.opacity = 1;


            if (productImages.length > 0) {
                hoverCard.addEventListener("mouseenter", function () {
                    //start
                    //console.log('start', intervalId, currentIndex);
                    if (intervalId === null) {
                        intervalId = setInterval(function () {
                            //console.log('start', intervalId, currentIndex);

                            productImages[currentIndex].style.opacity = 0; // Hide the current image
                            currentIndex = (currentIndex + 1) % productImages.length; // Cycle through the images
                            productImages[currentIndex].style.opacity = 1; // Show the next image
                        }, 1000);

                        //console.log('start', intervalId, currentIndex);

                    }
                });
                hoverCard.addEventListener("mouseleave", function () {
                    //stop

                    if (intervalId !== null) {
                        // reset
                        //console.log('stop', intervalId, currentIndex);
                        clearInterval(intervalId);


                        productImages[currentIndex].style.opacity = 0;
                        productImages[0].style.opacity = 1;

                        intervalId = null;
                        currentIndex = 0;
                    }
                });
            }
        });
    }

    var showMoreButton = document.getElementsByClassName('showMoreButton');
    
    for(i = 0; i<showMoreButton.length; i++){
        let button = showMoreButton[i];
        let category = button.getAttribute('category');        
        button.addEventListener('click', function () {
            let page = parseInt(button.getAttribute('page'));
            appendDataToContent(page, category, button);
            button.setAttribute('page', page+1)

            button.children[0].style.display = 'none';
            button.children[1].style.display = 'block';
        });
    }

    function seletedTagFilter(button){
        let tagFilter = $(button).attr('product_highlight');
        console.log(window.location.href)
        var url = new URL(window.location.href)
        url.searchParams.append("filter_by", tagFilter)
        filters.push(tagFilter)
        console.log(filters)
        window.location.replace(url)
    }

</script>
{% endblock %}